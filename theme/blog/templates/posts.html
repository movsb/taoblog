{{ render "header" . }}
<h1 style="text-align:center">全部文章列表</h1>
<table>
<thead>
<tr>
<th class=id width="80px">编号</th>
<th class=title>标题</th>
<th class=date width="150px">发表日期</th>
<th class=page_view width="80px">浏览量</th>
<th class=comments width="80px">评论数</th>
</tr>
</thead>
<tbody>
    {{range .Posts.Posts}}
    <tr>
    <td>{{.ID}}</td>
    <td><a href="/{{.ID}}/" target="_blank" title="{{.Title}}">{{.NonPublic}}{{.Title}}</a></td>
    <td>{{.DateString}}</td>
    <td>{{.PageView}}</td>
    <td>{{.Comments}}</td>
    </tr>
    {{end}}
</tbody>
</table>
<div class="footer">
{{ with .Posts }}
文章：{{.PostCount}}<span class=sep></span>页面：{{.PageCount}}<span class=sep></span>评论：{{.CommentCount}}<span class=sep></span>浏览：{{.ViewCount}}
{{ end }}
</div>
{{ render "footer" . }}

{{define "custom_header"}}
<style>
table {
    width: 100%;
    text-align: center;
}
tr:hover {
    background-color: lightgray;
}
@media (prefers-color-scheme: dark) {
	tr:hover {
		background-color: #4a4a4a;
	}
}
td:nth-child(2) {
    white-space: nowrap;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 0px;
}
@media screen and (max-width: 600px) {
    tr>*:nth-child(3), tr>*:nth-child(4),tr>*:nth-child(5) {
        display: none;
    }
}
.footer {
    border-top: 1px solid gray;
    margin: 2em 0 0 0;
    padding: 1em;
    text-align: center;
}
.footer .sep {
    margin: 0 1em 0 1em;
}
</style>
{{end}}

{{define "custom_footer"}}
<script>
    if('URLSearchParams' in window) {
        var table = document.getElementsByTagName('table')[0];
        table.addEventListener('click', function(ev) {
            if(ev.target.tagName === 'TH') {
                var th = ev.target;
                var searchParams = new URLSearchParams(location.search);
                var oldSort = (searchParams.get('sort')||'').split('.');
                if(oldSort.length != 2) {
                    oldSort = ['id','desc'];
                }
                var newSort = [th.classList[0], 'asc'];
                if(newSort[0] === oldSort[0]) {
                    newSort[1] = oldSort[1] === 'asc' ? 'desc' : 'asc';
                }
                searchParams.set('sort', newSort.join('.'));
                location.search = searchParams.toString();
            }
        });
    }
</script>
{{end}}
