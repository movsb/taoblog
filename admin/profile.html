<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>状态 - {{ .Name }}</title>
<link rel="icon" type="image/jpeg" href="/favicon.jpg">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
<script src="script.js"></script>
<style>
body {
    padding: 0px;
    margin: 1em;
}

@media screen and (min-width: 500px) {
	#wrapper {
		max-width: 300px;
	}
}

input, button {
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 0.8em;
	border: 1px solid #ddd;
	border-radius: 4px;
	padding-left: 7px;
	padding-right: 7px;
}
input[type=text],input[type=password] {
	line-height: 3em;
}
button, input[type=submit] {
	line-height: 3.5em;
	background-color: #eee;
	color: inherit;
}
button:hover, input[type=submit]:hover {
	background-color: #e8e8e8;
}
</style>
</head>
<body>
<div id="wrapper">
<h1>{{ .Name }}</h1>
<div class="user-info">
	<p><b>昵称：</b>{{ .User.DisplayName }}</p>
	<p><b>邮箱：</b>{{ .User.Email }}</p>
	{{ if .PublicKeys }}
	<p><b>公钥：</b></p>
	<ul>
		{{ range .PublicKeys }}
		<li>{{ . }}</li>
		{{ end}}
	</ul>
	{{ else }}
		<p><b>公钥：</b>(无)</p>
	{{ end }}
	<p><button onclick="register()">注册通行密钥</button></p>
</div>
<div>
	<p><button onclick="location.href='editor'">发表文章</button></p>
	<p><button onclick="location.href='/'">返回首页</button></p>
	<p><button onclick="location.href='logout'">退出登录</button></p>
</div>
	
</div>
<script>
async function register() {
	let wa = new WebAuthn();
	try {
		await wa.register();
		alert('新的通行密钥注册成功。');
	} catch(e) {
		if (e instanceof DOMException && e.name == "AbortError") {
			console.log('已取消操作。');
			return;
		}
		alert(e);
	}
}
</script>
</body>
</html>
